((function(){var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P=function(a,b){return function(){return a.apply(b,arguments)}},Q=Array.prototype.slice,R=Array.prototype.indexOf||function(a){for(var b=0,c=this.length;b<c;b++)if(this[b]===a)return b;return-1},S=Object.prototype.hasOwnProperty,T=function(a,b){function d(){this.constructor=a}for(var c in b)S.call(b,c)&&(a[c]=b[c]);return d.prototype=b.prototype,a.prototype=new d,a.__super__=b.prototype,a};c=function(){function a(a){this.name=a!=null?a:"",this.publish=P(this.publish,this),this.unsubscribe=P(this.unsubscribe,this),this.subscribe=P(this.subscribe,this),this.channels={}}return a.prototype.subscribe=function(a,b){return this.channels[a]==null&&(this.channels[a]=[]),this.channels[a].push({context:this,callback:b}),this},a.prototype.unsubscribe=function(a,b){var c,d,e,f;e=function(a,b){var c,d,e,f;f=[];for(c=0,e=a.length;c<e;c++){d=a[c];if(d.callback===b){a.splice(c,1);break}}return f};switch(typeof a){case"string":this.channels[a]!=null&&e(this.channels[a],b);break;case"function":f=this.channels;for(d in f)c=f[d],e(c,a)}return this},a.prototype.publish=function(a,b,c){var d,e,f,g,h,i,j;if(this.channels[a]!=null){j=this.channels[a];for(h=0,i=j.length;h<i;h++){f=j[h];if(c!==!0&&typeof b=="object"){d={};for(e in b)g=b[e],d[e]=g;f.callback.apply(f.context,[d,a])}else f.callback.apply(f.context,[b,a])}}return this},a.prototype.installTo=function(a){return typeof a=="object"&&(a.subscribe=this.subscribe,a.publish=this.publish),this},a}(),f=function(){function a(a,b,c){this.core=a,this.instanceId=b,this.options=c!=null?c:{};if(this.core==null)throw new Error("core was not defined");if(b==null)throw new Error("no id was specified");if(typeof b!="string")throw new Error("id is not a string")}return a.prototype.subscribe=function(){var a,b;return a=1<=arguments.length?Q.call(arguments,0):[],(b=this.core).subscribe.apply(b,Q.call(a).concat([this.instanceId]))},a.prototype.unsubscribe=function(){var a,b;return a=1<=arguments.length?Q.call(arguments,0):[],(b=this.core).unsubscribe.apply(b,Q.call(a).concat([this.instanceId]))},a.prototype.publish=function(){var a,b;return a=1<=arguments.length?Q.call(arguments,0):[],(b=this.core).publish.apply(b,Q.call(a).concat([this.instanceId]))},a}(),h="0.3",x={},t={},w=new c("core"),A={},p=function(a){return typeof console!="undefined"&&console!==null?typeof console.error=="function"?console.error(a.message):void 0:void 0},K=function(a){var b;a==null&&(a=8),b="";while(b.length<a)b+=Math.random().toString(36).substr(2);return b.substr(0,a)},z={_always:[]},y=function(a,b){var c;if(typeof a!="function")throw new Error("expect a function as parameter");c={context:this,callback:a};if(typeof b=="string")return z[b]==null&&(z[b]=[]),z[b].push(c);if(b==null)return z._always.push(c)},o=function(a,b,c){var d,e,g,h,i,j,k,l,n,o,p,q,r,s,u,v,w,y,B,C;b==null&&(b=a),k=x[a];if(t[b]!=null)return t[b];h={},y=k.options;for(j in y)r=y[j],h[j]=r;if(c)for(j in c)r=c[j],h[j]=r;p=new f(m,b,h);for(e in A){n=A[e];if(n.sandbox!=null){o=new n.sandbox(p);for(i in o)q=o[i],o.hasOwnProperty(i)&&(p[i]=q)}}g=new k.creator(p),g.options=h,g.id=b,t[b]=g,B=[b,"_always"];for(s=0,v=B.length;s<v;s++){l=B[s];if(z[l]!=null){C=z[l];for(u=0,w=C.length;u<w;u++)d=C[u],d.callback.apply(d.context)}}return g},j=function(a,b,c){var d;if(typeof a!="string")throw new Error("moudule ID has to be a string");if(typeof b!="function")throw new Error("creator has to be a constructor function");if(typeof c!="object")throw new Error("option parameter has to be an object");d=new b;if(typeof d!="object")throw new Error("creator has to return an object");if(typeof d.init!="function")throw new Error("module has to have an init function");if(typeof d.destroy!="function")throw new Error("module has to have a destroy function");if(x[a]!=null)throw new Error("module "+a+" was already registered");return x[a]={creator:b,options:c,id:a},!0},B=function(a,b,c){c==null&&(c={});try{return j(a,b,c)}catch(d){return p(new Error("could not register module: "+d.message)),!1}},L=function(a){return x[a]!=null?(delete x[a],!0):!1},M=function(){var a,b;b=[];for(a in x)b.push(L(a));return b},F=function(a,b){var c;b==null&&(b={});try{if(typeof a!="string")throw new Error("module ID has to be a string");if(typeof b!="object")throw new Error("second parameter has to be an object");if(x[a]==null)throw new Error("modle does not exist");c=o(a,b.instanceId,b.options);if(c.running===!0)throw new Error("module was already started");return c.init(c.options),c.running=!0,typeof b.callback=="function"&&b.callback(),!0}catch(d){return p(d),!1}},H=function(a){var b;return(b=t[a])?(b.destroy(),delete t[a]):!1},G=function(a,b){var c,d,e,f,g;if(a instanceof Array){d=a.length;for(f=0,g=a.length;f<g;f++)c=a[f],F(c,{callback:function(){return d--}})}else for(c in x)e=x[c],e&&F(c,e.options);return typeof a=="function"&&a(),!0},I=function(){var a,b;b=[];for(a in t)b.push(H(a));return b},n=["VERSION","register","unregister","registerPlugin","start","stop","startAll","stopAll","publish","subscribe","unsubscribe","Mediator","Sandbox","unregisterAll","uniqueId"],D=["core","instanceId","options","publish","subscribe","unsubscribe"],C=function(a){var b,c,d,e;try{if(typeof a!="object")throw new Error("plugin has to be an object");if(typeof a.id!="string")throw new Error("plugin has no id");if(typeof a.sandbox=="function"){for(b in new a.sandbox(new f(m,"")))if(R.call(D,b)>=0)throw new Error("plugin uses reserved keyword");d=a.sandbox.prototype;for(b in d)c=d[b],f.prototype[b]=c}if(typeof a.core=="object"){for(b in a.core)if(R.call(n,b)>=0)throw new Error("plugin uses reserved keyword");e=a.core;for(b in e)c=e[b],m[b]=c}return typeof a.onInstantiate=="function"&&y(a.onInstantiate),A[a.id]=a,!0}catch(g){return p(g),!1}},m={VERSION:h,register:B,unregister:L,unregisterAll:M,registerPlugin:C,start:F,stop:H,startAll:G,stopAll:I,publish:w.publish,subscribe:w.subscribe,unsubscribe:w.unsubscribe,uniqueId:K,Mediator:c,Sandbox:f};if(typeof exports!="undefined"&&exports!==null)for(u in m)O=m[u],exports[u]=O;typeof window!="undefined"&&window!==null&&(window.scaleApp=m),e=function(){function a(a){this.sb=a}return a.prototype._=function(a){var b;return b=this.sb.options.i18n,typeof b===!1?a:this.sb.core.i18n.get(b,a)},a.prototype.getLanguage=function(){return this.sb.core.i18n.getLanguage()},a.prototype.onLanguageChanged=function(a){return this.sb.core.i18n.subscribe(a)},a}(),k="en",r=function(){return(navigator.language||navigator.browserLanguage||baseLang).split("-")[0]},v=r(),w=new scaleApp.Mediator,l="i18n",J=function(a){return w.subscribe(l,a)},N=function(a){return w.unsubscribe(l,a)},s=function(){return v},E=function(a){if(typeof a=="string")return v=a,w.publish(l,v)},q=function(a,b){var c,d,e,f,g,h;return(c=(d=a[v])!=null?d[b]:void 0)!=null?c:(e=(f=a[v.substring(0,2)])!=null?f[b]:void 0)!=null?e:(g=(h=a[k])!=null?h[b]:void 0)!=null?g:b},scaleApp.registerPlugin({id:"i18n",sandbox:e,core:{i18n:{setLanguage:E,getBrowserLanguage:r,getLanguage:s,baseLanguage:k,get:q,subscribe:J,unsubscribe:N}}}),d=function(){function a(b){var c,d;a.__super__.constructor.call(this),this.id=(b!=null?b.id:void 0)||scaleApp.uniqueId();for(c in b)d=b[c],this[c]==null&&(this[c]=d)}return T(a,scaleApp.Mediator),a.reservedKeywords=["set","get"],a.prototype.set=function(b,c){var d,e,f;if(typeof b=="object"){f=[];for(d in b)e=b[d],f.push(this.set(d,e));return f}return R.call(a.reservedKeywords,b)>=0||this[b]!==c&&(this[b]=c,this.publish("changed")),this},a.prototype.get=function(a){return this[a]},a.prototype.toJSON=function(){var a,b,c;a={};for(b in this)c=this[b],this.hasOwnProperty(b)&&(a[b]=c);return a},a}(),i=function(){function a(a){a&&this.setModel(a)}return a.prototype.setModel=function(a){return this.model=a,this.model.subscribe("changed",P(function(){return this.render()},this))},a.prototype.render=function(){},a}(),a=function(){function a(a,b){this.model=a,this.view=b}return a}(),scaleApp.registerPlugin({id:"mvc",core:{Model:d,View:i,Controller:a}}),b=function(){function a(a){this.sb=a,this.getContainer=P(this.getContainer,this)}return a.prototype.getContainer=function(){switch(typeof this.sb.options.container){case"string":return document.getElementById(this.sb.options.container);case"object":return this.sb.options.container;default:return document.getElementById(this.sb.instanceId)}},a}(),scaleApp.registerPlugin({id:"dom",sandbox:b}),g=function(){function a(a){}return a.prototype.countObjectKeys=function(a){var b,c;if(typeof a=="object")return function(){var d;d=[];for(b in a)c=a[b],d.push(b);return d}().length},a.prototype.mixin=function(a,b,c){c==null&&(c=!1);switch(""+typeof b+"-"+typeof a){case"function-function":return this.mix(b.prototype,a.prototype,c);case"function-object":return this.mix(b.prototype,a,c);case"object-object":return this.mix(b,a,c);case"object-function":return this.mix(b,a.prototype,c)}},a.prototype.mix=function(a,b,c){var d,e,f,g;if(c===!0){f=[];for(d in a)e=a[d],f.push(b[d]=e);return f}g=[];for(d in a)e=a[d],b.hasOwnProperty(d)||g.push(b[d]=e);return g},a}(),scaleApp.registerPlugin({id:"util",sandbox:g})})).call(this);