((function(){var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A=function(a,b){return function(){return a.apply(b,arguments)}},B=Array.prototype.slice,C=Array.prototype.indexOf||function(a){for(var b=0,c=this.length;b<c;b++)if(this[b]===a)return b;return-1};a=function(){function a(a){this.name=a!=null?a:"",this.publish=A(this.publish,this),this.unsubscribe=A(this.unsubscribe,this),this.subscribe=A(this.subscribe,this),this.channels={}}return a.prototype.subscribe=function(a,b){return this.channels[a]==null&&(this.channels[a]=[]),this.channels[a].push({context:this,callback:b}),this},a.prototype.unsubscribe=function(a,b){var c,d,e,f;e=function(a,b){var c,d,e,f;f=[];for(c=0,e=a.length;c<e;c++){d=a[c];if(d.callback===b){a.splice(c,1);break}}return f};switch(typeof a){case"string":this.channels[a]!=null&&e(this.channels[a],b);break;case"function":f=this.channels;for(d in f)c=f[d],e(c,a)}return this},a.prototype.publish=function(a,b,c){var d,e,f,g,h,i,j;if(this.channels[a]!=null){j=this.channels[a];for(h=0,i=j.length;h<i;h++){f=j[h];if(c!==!0&&typeof b=="object"){d={};for(e in b)g=b[e],d[e]=g;f.callback.apply(f.context,[d,a])}else f.callback.apply(f.context,[b,a])}}return this},a.prototype.installTo=function(a){return typeof a=="object"&&(a.subscribe=this.subscribe,a.publish=this.publish),this},a}(),b=function(){function a(a,b,c){this.core=a,this.instanceId=b,this.options=c!=null?c:{};if(this.core==null)throw new Error("core was not defined");if(b==null)throw new Error("no id was specified");if(typeof b!="string")throw new Error("id is not a string")}return a.prototype.subscribe=function(){var a,b;return a=1<=arguments.length?B.call(arguments,0):[],(b=this.core).subscribe.apply(b,B.call(a).concat([this.instanceId]))},a.prototype.unsubscribe=function(){var a,b;return a=1<=arguments.length?B.call(arguments,0):[],(b=this.core).unsubscribe.apply(b,B.call(a).concat([this.instanceId]))},a.prototype.publish=function(){var a,b;return a=1<=arguments.length?B.call(arguments,0):[],(b=this.core).publish.apply(b,B.call(a).concat([this.instanceId]))},a}(),c="0.3",l={},i={},k=new a("core"),o={},h=function(a){return typeof console!="undefined"&&console!==null?typeof console.error=="function"?console.error(a.message):void 0:void 0},w=function(a){var b;a==null&&(a=8),b="";while(b.length<a)b+=Math.random().toString(36).substr(2);return b.substr(0,a)},n={_always:[]},m=function(a,b){var c;if(typeof a!="function")throw new Error("expect a function as parameter");c={context:this,callback:a};if(typeof b=="string")return n[b]==null&&(n[b]=[]),n[b].push(c);if(b==null)return n._always.push(c)},g=function(a,c,d){var f,g,h,j,k,m,p,q,r,s,t,u,v,w,x,y,z,A,B,C;c==null&&(c=a),p=l[a];if(i[c]!=null)return i[c];j={},A=p.options;for(m in A)v=A[m],j[m]=v;if(d)for(m in d)v=d[m],j[m]=v;t=new b(e,c,j);for(g in o){r=o[g];if(r.sandbox!=null){s=new r.sandbox(t);for(k in s)u=s[k],s.hasOwnProperty(k)&&(t[k]=u)}}h=new p.creator(t),h.options=j,h.id=c,i[c]=h,B=[c,"_always"];for(w=0,y=B.length;w<y;w++){q=B[w];if(n[q]!=null){C=n[q];for(x=0,z=C.length;x<z;x++)f=C[x],f.callback.apply(f.context)}}return h},d=function(a,b,c){var d;if(typeof a!="string")throw new Error("moudule ID has to be a string");if(typeof b!="function")throw new Error("creator has to be a constructor function");if(typeof c!="object")throw new Error("option parameter has to be an object");d=new b;if(typeof d!="object")throw new Error("creator has to return an object");if(typeof d.init!="function")throw new Error("module has to have an init function");if(typeof d.destroy!="function")throw new Error("module has to have a destroy function");if(l[a]!=null)throw new Error("module "+a+" was already registered");return l[a]={creator:b,options:c,id:a},!0},p=function(a,b,c){c==null&&(c={});try{return d(a,b,c)}catch(e){return h(new Error("could not register module: "+e.message)),!1}},x=function(a){return l[a]!=null?(delete l[a],!0):!1},y=function(){var a,b;b=[];for(a in l)b.push(x(a));return b},s=function(a,b){var c;b==null&&(b={});try{if(typeof a!="string")throw new Error("module ID has to be a string");if(typeof b!="object")throw new Error("second parameter has to be an object");if(l[a]==null)throw new Error("modle does not exist");c=g(a,b.instanceId,b.options);if(c.running===!0)throw new Error("module was already started");return c.init(c.options),c.running=!0,typeof b.callback=="function"&&b.callback(),!0}catch(d){return h(d),!1}},u=function(a){var b;return(b=i[a])?(b.destroy(),delete i[a]):!1},t=function(a,b){var c,d,e,f,g;if(a instanceof Array){d=a.length;for(f=0,g=a.length;f<g;f++)c=a[f],s(c,{callback:function(){return d--}})}else for(c in l)e=l[c],e&&s(c,e.options);return typeof a=="function"&&a(),!0},v=function(){var a,b;b=[];for(a in i)b.push(u(a));return b},f=["VERSION","register","unregister","registerPlugin","start","stop","startAll","stopAll","publish","subscribe","unsubscribe","Mediator","Sandbox","unregisterAll","uniqueId"],r=["core","instanceId","options","publish","subscribe","unsubscribe"],q=function(a){var c,d,g,i;try{if(typeof a!="object")throw new Error("plugin has to be an object");if(typeof a.id!="string")throw new Error("plugin has no id");if(typeof a.sandbox=="function"){for(c in new a.sandbox(new b(e,"")))if(C.call(r,c)>=0)throw new Error("plugin uses reserved keyword");g=a.sandbox.prototype;for(c in g)d=g[c],b.prototype[c]=d}if(typeof a.core=="object"){for(c in a.core)if(C.call(f,c)>=0)throw new Error("plugin uses reserved keyword");i=a.core;for(c in i)d=i[c],e[c]=d}return typeof a.onInstantiate=="function"&&m(a.onInstantiate),o[a.id]=a,!0}catch(j){return h(j),!1}},e={VERSION:c,register:p,unregister:x,unregisterAll:y,registerPlugin:q,start:s,stop:u,startAll:t,stopAll:v,publish:k.publish,subscribe:k.subscribe,unsubscribe:k.unsubscribe,uniqueId:w,Mediator:a,Sandbox:b};if(typeof exports!="undefined"&&exports!==null)for(j in e)z=e[j],exports[j]=z;typeof window!="undefined"&&window!==null&&(window.scaleApp=e)})).call(this);